<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√°y T√≠nh Th·ªëng K√™</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>üìä M√°y T√≠nh Th·ªëng K√™</h1>
            <p>Nh·∫≠p d√£y s·ªë nguy√™n ƒë·ªÉ ph√¢n t√≠ch th·ªëng k√™ v·ªõi gi·∫£i th√≠ch c√°ch t√≠nh</p>
        </header>

        <div class="input-section">
            <label for="numberInput">Nh·∫≠p d√£y s·ªë (c√°ch nhau b·∫±ng d·∫•u ph·∫©y ho·∫∑c kho·∫£ng tr·∫Øng):</label>
            <input type="text" id="numberInput" placeholder="V√≠ d·ª•: 1, 2, 3, 4, 5 ho·∫∑c 1 2 3 4 5">
            <button onclick="calculateStats()">T√≠nh To√°n</button>
            <button onclick="clearAll()">X√≥a</button>
        </div>

        <div id="results" class="results hidden">
            <div class="stat-card">
                <h3>üìà D√£y S·ªë ƒê√£ S·∫Øp X·∫øp</h3>
                <div id="sortedArray" class="result-value"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>üìä Trung B√¨nh 
                        <button class="show-calculation" onclick="toggleCalculation('mean-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="mean" class="result-value"></div>
                    <div id="mean-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>üìç Trung V·ªã 
                        <button class="show-calculation" onclick="toggleCalculation('median-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="median" class="result-value"></div>
                    <div id="median-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>üéØ Mode 
                        <button class="show-calculation" onclick="toggleCalculation('mode-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="mode" class="result-value"></div>
                    <div id="mode-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>‚¨ÜÔ∏è GTLN (Max) 
                        <button class="show-calculation" onclick="toggleCalculation('max-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="max" class="result-value"></div>
                    <div id="max-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>‚¨áÔ∏è GTNN (Min) 
                        <button class="show-calculation" onclick="toggleCalculation('min-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="min" class="result-value"></div>
                    <div id="min-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>‚ÜîÔ∏è Kho·∫£ng (Range) 
                        <button class="show-calculation" onclick="toggleCalculation('range-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="range" class="result-value"></div>
                    <div id="range-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>üìè Ph∆∞∆°ng Sai 
                        <button class="show-calculation" onclick="toggleCalculation('variance-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="variance" class="result-value"></div>
                    <div id="variance-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>üìê ƒê·ªô L·ªách Chu·∫©n 
                        <button class="show-calculation" onclick="toggleCalculation('stddev-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="stdDev" class="result-value"></div>
                    <div id="stddev-calc" class="calculation-steps"></div>
                </div>

                <div class="stat-card">
                    <h4>üìä H·ªá S·ªë Bi·∫øn Thi√™n 
                        <button class="show-calculation" onclick="toggleCalculation('coeff-calc')">Xem c√°ch t√≠nh</button>
                    </h4>
                    <div id="coeffVar" class="result-value"></div>
                    <div id="coeff-calc" class="calculation-steps"></div>
                </div>
            </div>
        </div>

        <div id="error" class="error hidden"></div>
    </div>

    <script>
        let currentNumbers = [];
        let currentStats = {};

        function parseInput(input) {
            return input.split(/[,\s]+/)
                .map(num => num.trim())
                .filter(num => num !== '')
                .map(num => parseFloat(num))
                .filter(num => !isNaN(num));
        }

        function calculateMean(arr) {
            return arr.reduce((sum, num) => sum + num, 0) / arr.length;
        }

        function calculateMedian(sortedArr) {
            const mid = Math.floor(sortedArr.length / 2);
            return sortedArr.length % 2 === 0
                ? (sortedArr[mid - 1] + sortedArr[mid]) / 2
                : sortedArr[mid];
        }

        function calculateMode(arr) {
            const frequency = {};
            arr.forEach(num => frequency[num] = (frequency[num] || 0) + 1);

            const maxFreq = Math.max(...Object.values(frequency));
            const modes = Object.keys(frequency).filter(key => frequency[key] === maxFreq);

            if (modes.length === arr.length) {
                return "Kh√¥ng c√≥ mode";
            }

            return modes.map(Number).sort((a, b) => a - b).join(', ');
        }

        function calculateVariance(arr, mean) {
            const sumSquaredDiffs = arr.reduce((sum, num) => sum + Math.pow(num - mean, 2), 0);
            return sumSquaredDiffs / (arr.length - 1);
        }

        function generateMeanExplanation(numbers, mean) {
            const sum = numbers.reduce((a, b) => a + b, 0);
            return `C√¥ng th·ª©c: Trung b√¨nh = T·ªïng c√°c s·ªë / S·ªë l∆∞·ª£ng ph·∫ßn t·ª≠

T√≠nh to√°n:
T·ªïng = ${numbers.join(' + ')} = ${sum}
S·ªë l∆∞·ª£ng ph·∫ßn t·ª≠ = ${numbers.length}

Trung b√¨nh = ${sum} √∑ ${numbers.length} = ${mean.toFixed(2)}`;
        }

        function generateMedianExplanation(sortedNumbers, median) {
            const n = sortedNumbers.length;
            const mid = Math.floor(n / 2);
            
            let explanation = `D√£y s·ªë ƒë√£ s·∫Øp x·∫øp: [${sortedNumbers.join(', ')}]
S·ªë l∆∞·ª£ng ph·∫ßn t·ª≠: ${n}\n\n`;

            if (n % 2 === 0) {
                explanation += `V√¨ c√≥ ${n} ph·∫ßn t·ª≠ (ch·∫µn), trung v·ªã l√† trung b√¨nh c·ªßa 2 s·ªë ·ªü gi·ªØa:
V·ªã tr√≠ gi·ªØa: ${mid} v√† ${mid + 1}
Ph·∫ßn t·ª≠ th·ª© ${mid}: ${sortedNumbers[mid - 1]}
Ph·∫ßn t·ª≠ th·ª© ${mid + 1}: ${sortedNumbers[mid]}

Trung v·ªã = (${sortedNumbers[mid - 1]} + ${sortedNumbers[mid]}) √∑ 2 = ${median}`;
            } else {
                explanation += `V√¨ c√≥ ${n} ph·∫ßn t·ª≠ (l·∫ª), trung v·ªã l√† s·ªë ·ªü gi·ªØa:
V·ªã tr√≠ gi·ªØa: ${mid + 1}
Trung v·ªã = ${sortedNumbers[mid]}`;
            }
            
            return explanation;
        }

        function generateModeExplanation(numbers) {
            const frequency = {};
            numbers.forEach(num => frequency[num] = (frequency[num] || 0) + 1);

            let explanation = `ƒê·∫øm t·∫ßn su·∫•t xu·∫•t hi·ªán c·ªßa m·ªói s·ªë:\n`;
            Object.keys(frequency).sort((a, b) => a - b).forEach(num => {
                explanation += `${num}: xu·∫•t hi·ªán ${frequency[num]} l·∫ßn\n`;
            });

            const maxFreq = Math.max(...Object.values(frequency));
            const modes = Object.keys(frequency).filter(key => frequency[key] === maxFreq);

            if (modes.length === numbers.length) {
                explanation += `\nM·ªói s·ªë ch·ªâ xu·∫•t hi·ªán 1 l·∫ßn ‚Üí Kh√¥ng c√≥ mode`;
            } else {
                explanation += `\nT·∫ßn su·∫•t cao nh·∫•t: ${maxFreq} l·∫ßn
C√°c s·ªë c√≥ t·∫ßn su·∫•t cao nh·∫•t: ${modes.join(', ')}`;
            }

            return explanation;
        }

        function generateVarianceExplanation(numbers, mean, variance) {
            let explanation = `C√¥ng th·ª©c: s¬≤ = Œ£(xi - xÃÑ)¬≤ / (n-1)

Trong ƒë√≥:
- xi: t·ª´ng ph·∫ßn t·ª≠ trong d√£y
- xÃÑ: trung b√¨nh = ${mean.toFixed(2)}
- n: s·ªë ph·∫ßn t·ª≠ = ${numbers.length}

T√≠nh to√°n t·ª´ng b∆∞·ªõc:`;

            numbers.forEach((num, i) => {
                const diff = num - mean;
                const squared = Math.pow(diff, 2);
                explanation += `\n(${num} - ${mean.toFixed(2)})¬≤ = ${diff.toFixed(2)}¬≤ = ${squared.toFixed(2)}`;
            });

            const sumSquared = numbers.reduce((sum, num) => sum + Math.pow(num - mean, 2), 0);
            explanation += `\n\nT·ªïng c√°c b√¨nh ph∆∞∆°ng: ${sumSquared.toFixed(2)}
Ph∆∞∆°ng sai = ${sumSquared.toFixed(2)} √∑ (${numbers.length} - 1) = ${variance.toFixed(2)}`;

            return explanation;
        }

        function generateStdDevExplanation(variance, stdDev) {
            return `C√¥ng th·ª©c: s = ‚àös¬≤

ƒê·ªô l·ªách chu·∫©n = ‚àö${variance.toFixed(2)} = ${stdDev.toFixed(2)}`;
        }

        function generateCoeffVarExplanation(stdDev, mean, coeffVar) {
            return `C√¥ng th·ª©c: CV = (s / |xÃÑ|) √ó 100%

Trong ƒë√≥:
- s: ƒë·ªô l·ªách chu·∫©n = ${stdDev.toFixed(2)}
- |xÃÑ|: tr·ªã tuy·ªát ƒë·ªëi c·ªßa trung b√¨nh = ${Math.abs(mean).toFixed(2)}

CV = (${stdDev.toFixed(2)} / ${Math.abs(mean).toFixed(2)}) √ó 100% = ${coeffVar.toFixed(2)}%`;
        }

        function calculateStats() {
            const input = document.getElementById('numberInput').value;
            const errorDiv = document.getElementById('error');
            const resultsDiv = document.getElementById('results');

            errorDiv.classList.add('hidden');

            if (!input.trim()) {
                showError('Vui l√≤ng nh·∫≠p d√£y s·ªë!');
                return;
            }

            const numbers = parseInput(input);

            if (numbers.length === 0) {
                showError('Kh√¥ng t√¨m th·∫•y s·ªë h·ª£p l·ªá!');
                return;
            }

            if (numbers.length < 2) {
                showError('C·∫ßn √≠t nh·∫•t 2 s·ªë ƒë·ªÉ t√≠nh ph∆∞∆°ng sai v√† ƒë·ªô l·ªách chu·∫©n!');
                return;
            }

            currentNumbers = numbers;
            const sortedNumbers = [...numbers].sort((a, b) => a - b);

            // Calculate all statistics
            const mean = calculateMean(numbers);
            const median = calculateMedian(sortedNumbers);
            const mode = calculateMode(numbers);
            const max = Math.max(...numbers);
            const min = Math.min(...numbers);
            const range = max - min;
            const variance = calculateVariance(numbers, mean);
            const stdDev = Math.sqrt(variance);
            const coeffVar = mean !== 0 ? (stdDev / Math.abs(mean)) * 100 : 0;

            currentStats = {
                mean, median, mode, max, min, range, variance, stdDev, coeffVar,
                sortedNumbers, numbers
            };

            // Display results
            document.getElementById('sortedArray').textContent = sortedNumbers.join(', ');
            document.getElementById('mean').textContent = mean.toFixed(2);
            document.getElementById('median').textContent = median.toFixed(2);
            document.getElementById('mode').textContent = mode;
            document.getElementById('max').textContent = max;
            document.getElementById('min').textContent = min;
            document.getElementById('range').textContent = range;
            document.getElementById('variance').textContent = variance.toFixed(2);
            document.getElementById('stdDev').textContent = stdDev.toFixed(2);
            document.getElementById('coeffVar').textContent = coeffVar.toFixed(2) + '%';

            // Prepare explanations
            document.getElementById('mean-calc').textContent = generateMeanExplanation(numbers, mean);
            document.getElementById('median-calc').textContent = generateMedianExplanation(sortedNumbers, median);
            document.getElementById('mode-calc').textContent = generateModeExplanation(numbers);
            document.getElementById('max-calc').textContent = `Trong d√£y s·ªë [${sortedNumbers.join(', ')}]
Gi√° tr·ªã l·ªõn nh·∫•t l√†: ${max}`;
            document.getElementById('min-calc').textContent = `Trong d√£y s·ªë [${sortedNumbers.join(', ')}]
Gi√° tr·ªã nh·ªè nh·∫•t l√†: ${min}`;
            document.getElementById('range-calc').textContent = `Kho·∫£ng = GTLN - GTNN
Kho·∫£ng = ${max} - ${min} = ${range}`;
            document.getElementById('variance-calc').textContent = generateVarianceExplanation(numbers, mean, variance);
            document.getElementById('stddev-calc').textContent = generateStdDevExplanation(variance, stdDev);
            document.getElementById('coeff-calc').textContent = generateCoeffVarExplanation(stdDev, mean, coeffVar);

            resultsDiv.classList.remove('hidden');
        }

        function toggleCalculation(calcId) {
            const calcDiv = document.getElementById(calcId);
            calcDiv.classList.toggle('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
        }

        function clearAll() {
            document.getElementById('numberInput').value = '';
            document.getElementById('results').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            
            // Hide all calculation steps
            document.querySelectorAll('.calculation-steps').forEach(calc => {
                calc.classList.remove('show');
            });
        }

        // Allow Enter key to trigger calculation
        document.getElementById('numberInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                calculateStats();
            }
        });
    </script>
</body>

</html>
